# Development Dockerfile for Astro with Hot Reload
FROM node:20-alpine

WORKDIR /app

# Enable corepack to use pnpm
RUN corepack enable

# Copy package files first for caching
COPY package.json pnpm-lock.yaml ./

# Install dependencies
RUN pnpm install

# Copy entrypoint script
COPY docker-entrypoint.sh /docker-entrypoint.sh
RUN chmod +x /docker-entrypoint.sh

# Copy the rest of the code (will be overwritten by volume mount)
COPY . .

# Expose Astro dev server port
EXPOSE 4321

# Start development server via entrypoint (loads .env first)
CMD ["/docker-entrypoint.sh"]
